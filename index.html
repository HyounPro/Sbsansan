<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ìˆ˜ê°•ìƒ ê°œê°•ì•ˆë‚´ ìƒì„±ì‚¬ì´íŠ¸</title>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      padding: 40px;
      line-height: 1.8;
    }
    input {
      padding: 6px;
      width: 300px;
      margin: 10px 0;
    }
    button {
      padding: 6px 12px;
      margin-left: 10px;
      cursor: pointer;
    }
    pre {
      background: #f4f4f4;
      padding: 20px;
      border-radius: 5px;
      white-space: pre-wrap;
    }
    .mapping-box {
      background:#f9f9f9;
      padding:15px;
      border-left:4px solid #0077cc;
      margin-bottom:20px;
    }
  </style>
</head>
<body>

  <h2>ğŸ“˜ SBSì»´í“¨í„°ì•„íŠ¸í•™ì› ê°œê°•ì•ˆë‚´</h2>

  <div class="mapping-box">
    <strong>ğŸ’¡ ê³¼ëª©ì…ë ¥ ê°€ì´ë“œ</strong><br>
    ê³¼ëª©ëª…(ê²©ì¼)_ìˆ˜ì—…ì‹œì‘ì‹œê°„ í˜•ì‹ìœ¼ë¡œ ì…ë ¥<br>
    ì›”~ëª© ìˆ˜ì—… : í¬í† ìƒµ_9<br>
    ê²©ì¼ ìˆ˜ì—… : í¬í† ìƒµ(ì›”ìˆ˜ê¸ˆ)_19<br>
    ì£¼ë§ ìˆ˜ì—… : í¬í† ìƒµ/ì£¼_9<br>
    ë“œë¡œì‰ : ë””ì§€í„¸ë“œë¡œì‰(ì›”ìˆ˜ê¸ˆ)_9<br>
    ë°©íŠ¹ : í¬í† ìƒµ1/ë°©í•™_13.5<br>
    ì˜ ì‚¬ìš©í•´ì£¼ì„¸ìš”!
  </div>

  <label for="subjectInput">ê³¼ëª©ëª…ê³¼ ì‹œê°„ íƒ€ì…ì„ ì½¤ë§ˆ(,)ë¡œ ì…ë ¥í•˜ì„¸ìš”:</label><br>
  <input type="text" id="subjectInput" placeholder="ì˜ˆ: ì¼ëŸ¬ìŠ¤íŠ¸_9, í¬í† ìƒµ_11">
  <button onclick="generate()">ìƒì„±</button>
  <button onclick="copyToClipboard()">ë³µì‚¬</button>

  <h3>ğŸ“ ê°œê°•ì•ˆë‚´ ê²°ê³¼ëŠ” ë³µì‚¬í•´ì„œ ì‚¬ìš©í•˜ì‹œë©´ ë©ë‹ˆë‹¤.</h3>
  <pre id="output"></pre>

  <script>
    let courseData = [];

    const csvUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vTYdUa8OjpFuhycdQ-NWK4EciYYt1CH0YykLHn9hlE5yCK1SKsYgHzWHkZghd3bnkBL_WiGAoyFGp3t/pub?output=csv';

    const roomLinks = {
      'A': 'https://discord.gg/UbPVxWgcct',
      'B': 'https://discord.gg/VBaPncjxXe',
      'C': 'https://discord.gg/2WcQwuzvxy',
      'D': 'https://discord.gg/bHxVuv3AxS',
      'E': 'https://discord.gg/AsV8M6P79c',
      'F': 'https://discord.gg/cEDxpq6aVS',
      'G': 'https://discord.gg/KrHJzzErWt',
      'H': 'ë¹„ëŒ€ë©´ ìˆ˜ì—… ë¶ˆê°€ëŠ¥'
    };

    const scheduleToPeriod = {
      "ì›”ìˆ˜ê¸ˆ9": "06.13~07.07",
      "í™”ëª©ê¸ˆ9": "06.12~07.04",
      "ì›”ìˆ˜ê¸ˆ10": "06.13~07.09",
      "í™”ëª©ê¸ˆ10": "06.12~07.08",
      "ì›”ëª©": "06.12~07.09",
      "ê¸ˆ": "06.13~07.04",
      "í† ì¼": "06.07~06.29"
    };

    async function fetchCSV() {
      const response = await fetch(csvUrl);
      const text = await response.text();
      const rows = text.trim().split('\n');
      const headers = rows[0].split(',');
      courseData = rows.slice(1).map(row => {
        const values = row.split(',');
        const entry = {};
        headers.forEach((header, i) => {
          entry[header.trim()] = values[i]?.trim();
        });
        return entry;
      });
    }

    async function generate() {
      if (courseData.length === 0) {
        await fetchCSV();
      }

      const input = document.getElementById("subjectInput").value;
      const subjects = input.split(',').map(s => s.trim()).filter(Boolean);
      if (subjects.length === 0) {
        document.getElementById("output").textContent = "ê³¼ëª©ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.";
        return;
      }

      let message = `ğŸ“¢ SBSì»´í“¨í„°ì•„íŠ¸í•™ì› ì•ˆì‚°ì  ê°œê°•ì•ˆë‚´\n\n`;

      subjects.forEach(subjectInput => {
        const subjectBase = subjectInput.split('_')[0];
        const row = courseData.find(item => item['ê³¼ëª©ëª…'].startsWith(subjectBase));
        
        if (!row) {
          message += `âš  ê³¼ëª© "${subjectInput}"ì˜ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n\n`;
          return;
        }

        const schedule = row['ì‹œê°„í‘œìœ í˜•'];
        const period = scheduleToPeriod[schedule] || 'ìˆ˜ê°•ê¸°ê°„ ë¯¸ì •';
        const time = row['ìˆ˜ì—…ì‹œê°„'] || 'ì‹œê°„ ë¯¸ì •';
        const room = row['ê°•ì˜ì¥']?.toUpperCase();
        const link = roomLinks[room] || 'ë¹„ëŒ€ë©´ ë§í¬ ì •ë³´ ì—†ìŒ';

        message += `Â· ìˆ˜ê°•ê³¼ëª© : ${subjectBase}
Â· ìˆ˜ê°•ê¸°ê°„ : ${period}
Â· ìˆ˜ê°•ì‹œê°„ : ${time}
Â· ê°•ì˜ì‹¤ : 3ì¸µ ${room}ê°•ì˜ì¥ 
Â· ë¹„ëŒ€ë©´ë§í¬ : ${room}ê°•ì˜ì¥ ${link}
Â· ëŒ€ë©´/ë¹„ëŒ€ë©´ : ëŒ€ë©´\n\n`;
      });

      message += `âš  ë³€ë™ ì‚¬í•­ ë°œìƒ ì‹œ, ìˆ˜ì—… ì „ ì¬ ì•ˆë‚´ ë“œë¦¬ê² ìŠµë‹ˆë‹¤

í™•ì¸ í›„ì— ëŒ€ë©´/ë¹„ëŒ€ë©´/ì°¸ì„ ì—¬ë¶€ í™•ì¸ ë‹µì¥ ë¶€íƒë“œë¦½ë‹ˆë‹¤ğŸ˜Š

ê²©ì¼ì‹œê°„í‘œ/ì˜¨ë¼ì¸ê°•ì˜/ë¹„ëŒ€ë©´ë§í¬/êµì¬êµ¬ì…ë“± ìì„¸í•œ ë‚´ìš©ì€ ê³µì§€ì‚¬í•­ ë§í¬ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”!`;

      document.getElementById("output").textContent = message;
    }

    function copyToClipboard() {
      const text = document.getElementById("output").textContent;
      if (!text.trim()) {
        alert("ë¨¼ì € ì•ˆë‚´ë¬¸ì„ ìƒì„±í•´ì£¼ì„¸ìš”!");
        return;
      }
      navigator.clipboard.writeText(text).then(() => {
        alert("âœ… ì•ˆë‚´ë¬¸ì´ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!");
      });
    }
  </script>

</body>
</html>
